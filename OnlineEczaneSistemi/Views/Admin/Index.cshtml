@model List<OnlineEczaneSistemi.Models.User>

<h2 class="mb-4">Admin Panel – Kullanıcı Yönetimi</h2>

<form method="get" class="mb-4">
    <div class="row">

        <!-- Arama -->
        <div class="col-md-4">
            <input type="text" name="search"
                   value="@Context.Request.Query["search"]"
                   class="form-control"
                   placeholder="İsim veya e-posta ile ara..." />
        </div>

        <!-- Rol Filtre -->
        <div class="col-md-3">
            <select name="role" class="form-control">

                @{
                    var selectedRole = Context.Request.Query["role"].ToString();
                }

                    <option value="all" selected="@(selectedRole == "all" || string.IsNullOrEmpty(selectedRole))">Tüm Roller</option>
                    <option value="Admin" selected="@(selectedRole == "Admin")">Admin</option>
                <option value="User" selected="@(selectedRole == "User")">User (Hasta)</option>
                <option value="Pharmacy" selected="@(selectedRole == "Pharmacy")">Eczane</option>
                <option value="Courier" selected="@(selectedRole == "Courier")">Kurye</option>

            </select>
        </div>

        <!-- Durum Filtre -->
        <div class="col-md-3">
            @{
                var selectedStatus = Context.Request.Query["status"].ToString();
            }

            <select name="status" class="form-control">
                <option value="all" selected="@(selectedStatus == "all" || string.IsNullOrEmpty(selectedStatus))">Tümü</option>
                <option value="active" selected="@(selectedStatus == "active")">Aktif</option>
                <option value="passive" selected="@(selectedStatus == "passive")">Pasif</option>
            </select>
        </div>

        <div class="col-md-2">
            <button class="btn btn-primary w-100">Filtrele</button>
        </div>

    </div>
</form>



<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Profil</th>
            <th>Ad Soyad</th>
            <th>Email</th>
            <th>Rol</th>
            <th>Durum</th>
            <th>İşlemler</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var user in Model)
        {
            <tr>
                <td>
                    @if (!string.IsNullOrEmpty(user.ImageUrl))
                    {
                        <img src="@user.ImageUrl"
                             width="40" height="40"
                             style="border-radius:50%; object-fit:cover;" />
                    }
                    else { <span>-</span> }
                </td>

                <td>@user.FullName</td>
                <td>@user.Email</td>

                <td>
                    @if (user.Role == "User")
                    {
                        <span class="badge bg-info">Hasta</span>
                    }
                    else if (user.Role == "Pharmacy")
                    {
                        <span class="badge bg-success">Eczane</span>
                    }
                    else if (user.Role == "Courier")
                    {
                        <span class="badge bg-warning">Kurye</span>
                    }
                    else
                    {
                        <span class="badge bg-dark">Admin</span>
                    }
                </td>

                <td>
                    @if (user.IsActive)
                    {
                        <span class="text-success">Aktif</span>
                    }
                    else
                    {
                        <span class="text-danger">Pasif</span>
                    }
                </td>

                <td>
                    <a class="btn btn-warning btn-sm" href="/Admin/ToggleStatus/@user.UserId">Durumu Değiştir</a>

                    @if (user.Role == "Admin")
                    {
                        <a class="btn btn-danger btn-sm" href="/Admin/MakeUser/@user.UserId">User Yap</a>
                    }
                    else
                    {
                        <a class="btn btn-info btn-sm" href="/Admin/MakeAdmin/@user.UserId">Admin Yap</a>
                    }

                    <a class="btn btn-primary btn-sm" href="/Admin/Details/@user.UserId">Detay</a>
                </td>
            </tr>
        }
    </tbody>
</table>
